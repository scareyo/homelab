apiVersion: batch/v1
kind: CronJob
metadata:
  labels:
    app.kubernetes.io/component: main
    app.kubernetes.io/instance: calibre-import
    app.kubernetes.io/name: calibre-import
    app.kubernetes.io/part-of: calibre
    app.kubernetes.io/version: "13"
  name: calibre-import
  namespace: calibre
spec:
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
            app.kubernetes.io/component: main
            app.kubernetes.io/instance: calibre-import
            app.kubernetes.io/name: calibre-import
            app.kubernetes.io/part-of: calibre
            app.kubernetes.io/version: "13"
        spec:
          containers:
            - args:
                - /mnt/downloads
                - -name
                - '*.epub'
                - -exec
                - cp
                - '{}'
                - /mnt/incoming
                - ;
              command:
                - find
              env: []
              image: debian:13
              name: calibre-import
              ports: []
              securityContext:
                allowPrivilegeEscalation: false
                capabilities:
                  drop:
                    - ALL
                readOnlyRootFilesystem: true
              volumeMounts:
                - mountPath: /mnt/downloads
                  name: downloads
                - mountPath: /mnt/incoming
                  name: incoming
          restartPolicy: OnFailure
          securityContext:
            fsGroup: 65534
            fsGroupChangePolicy: OnRootMismatch
            runAsGroup: 1000
            runAsUser: 1000
          volumes:
            - name: downloads
              nfs:
                path: /mnt/nami-01/media/downloads
                readOnly: true
                server: nami.int.scarey.me
            - name: incoming
              nfs:
                path: /mnt/nami-01/media/books/incoming
                readOnly: false
                server: nami.int.scarey.me
  schedule: 0 0 * * *
