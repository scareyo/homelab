apiVersion: v1
data:
  grafana.ini: "[analytics]\ncheck_for_updates = true\n[auth.generic_oauth]\napi_url = https://id.vegapunk.cloud/api/oidc/user(info|INFO)\nauth_url = https://id.vegapunk.cloud/authorize\nclient_id = $__file{/etc/secrets/oauth/client_id}\nclient_secret = $__file{/etc/secrets/oauth/client_secret}\nenabled = true\nrole_attribute_path = contains(groups, 'grafana_admin') && 'Admin' || contains(groups, 'grafana_editor') && 'Editor' || contains(groups, 'grafana_viewer') && 'Viewer' \nscopes = openid email profile groups\ntoken_url = https://id.vegapunk.cloud/api/oidc/token\n[grafana_net]\nurl = https://grafana.net\n[log]\nmode = console\n[paths]\ndata = /var/lib/grafana/\nlogs = /var/log/grafana\nplugins = /var/lib/grafana/plugins\nprovisioning = /etc/grafana/provisioning\n[server]\ndomain = ''\nroot_url = https://grafana.vegapunk.cloud\n"
  plugins: victoriametrics-logs-datasource
  victoria-logs.yaml: |
    apiVersion: 1
    datasources:
    - jsonData:
        logLevelRules:
        - enabled: true
          field: message.level
          level: critical
          operator: regex
          value: crit|critical|CRIT|CRITICAL
        - enabled: true
          field: _msg
          level: critical
          operator: regex
          value: ^(crit|critical|CRIT|CRITICAL)\s
        - enabled: true
          field: _msg
          level: critical
          operator: regex
          value: level=(crit|critical|CRIT|CRITICAL)
        - enabled: true
          field: _msg
          level: critical
          operator: regex
          value: \s(crit|critical|CRIT|CRITICAL)\s
        - enabled: true
          field: _msg
          level: critical
          operator: regex
          value: \t(crit|critical|CRIT|CRITICAL)\t
        - enabled: true
          field: _msg
          level: critical
          operator: regex
          value: ^C\d{4}\s
        - enabled: true
          field: message.level
          level: warning
          operator: regex
          value: warn|warning|WARN|WARNING
        - enabled: true
          field: _msg
          level: warning
          operator: regex
          value: ^(warn|warning|WARN|WARNING)\s
        - enabled: true
          field: _msg
          level: warning
          operator: regex
          value: level=(warn|warning|WARN|WARNING)
        - enabled: true
          field: _msg
          level: warning
          operator: regex
          value: \s(warn|warning|WARN|WARNING)\s
        - enabled: true
          field: _msg
          level: warning
          operator: regex
          value: \t(warn|warning|WARN|WARNING)\t
        - enabled: true
          field: _msg
          level: warning
          operator: regex
          value: ^W\d{4}\s
        - enabled: true
          field: message.level
          level: error
          operator: regex
          value: err|error|ERR|ERROR
        - enabled: true
          field: _msg
          level: error
          operator: regex
          value: ^(err|error|ERR|ERROR)\s
        - enabled: true
          field: _msg
          level: error
          operator: regex
          value: level=(err|error|ERR|ERROR)
        - enabled: true
          field: _msg
          level: error
          operator: regex
          value: \s(err|error|ERR|ERROR)\s
        - enabled: true
          field: _msg
          level: error
          operator: regex
          value: \t(err|error|ERR|ERROR)\t
        - enabled: true
          field: _msg
          level: error
          operator: regex
          value: ^E\d{4}\s
        - enabled: true
          field: message.level
          level: info
          operator: regex
          value: info|information|audit|cluster|I|INFO
        - enabled: true
          field: _msg
          level: info
          operator: regex
          value: ^(info|information|audit|cluster|I|INFO)\s
        - enabled: true
          field: _msg
          level: info
          operator: regex
          value: level=(info|information|audit|cluster|I|INFO)
        - enabled: true
          field: _msg
          level: info
          operator: regex
          value: \s(info|information|audit|cluster|I|INFO)\s
        - enabled: true
          field: _msg
          level: info
          operator: regex
          value: \t(info|information|audit|cluster|I|INFO)\t
        - enabled: true
          field: _msg
          level: info
          operator: regex
          value: ^I\d{4}\s
        - enabled: true
          field: message.level
          level: debug
          operator: regex
          value: debug|DEBUG
        - enabled: true
          field: _msg
          level: debug
          operator: regex
          value: ^(debug|DEBUG)\s
        - enabled: true
          field: _msg
          level: debug
          operator: regex
          value: level=(debug|DEBUG)
        - enabled: true
          field: _msg
          level: debug
          operator: regex
          value: \s(debug|DEBUG)\s
        - enabled: true
          field: _msg
          level: debug
          operator: regex
          value: \t(debug|DEBUG)\t
        - enabled: true
          field: _msg
          level: debug
          operator: regex
          value: ^D\d{4}\s
        - enabled: true
          field: message.level
          level: trace
          operator: regex
          value: trace|TRACE
        - enabled: true
          field: _msg
          level: trace
          operator: regex
          value: ^(trace|TRACE)\s
        - enabled: true
          field: _msg
          level: trace
          operator: regex
          value: level=(trace|TRACE)
        - enabled: true
          field: _msg
          level: trace
          operator: regex
          value: \s(trace|TRACE)\s
        - enabled: true
          field: _msg
          level: trace
          operator: regex
          value: \t(trace|TRACE)\t
        - enabled: true
          field: _msg
          level: trace
          operator: regex
          value: ^T\d{4}\s
      name: VictoriaLogs
      type: victoriametrics-logs-datasource
      url: http://vlsingle-victoria-logs:9428
kind: ConfigMap
metadata:
  labels:
    app.kubernetes.io/instance: vm
    app.kubernetes.io/name: grafana
    app.kubernetes.io/version: 12.3.0
    helm.sh/chart: grafana-10.1.5
  name: vm-grafana
  namespace: monitoring
