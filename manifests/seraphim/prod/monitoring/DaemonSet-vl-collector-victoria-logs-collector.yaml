apiVersion: apps/v1
kind: DaemonSet
metadata:
  labels:
    app.kubernetes.io/instance: vl-collector
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: victoria-logs-collector
    app.kubernetes.io/version: v1.43.1
    helm.sh/chart: victoria-logs-collector-0.2.6
  name: vl-collector-victoria-logs-collector
  namespace: monitoring
spec:
  selector:
    matchLabels:
      app.kubernetes.io/instance: vl-collector
      app.kubernetes.io/name: victoria-logs-collector
  template:
    metadata:
      labels:
        app.kubernetes.io/instance: vl-collector
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/name: victoria-logs-collector
    spec:
      containers:
        - args:
            - --envflag.enable
            - --envflag.prefix=VL_
            - --kubernetesCollector
            - --kubernetesCollector.includeNodeAnnotations=false
            - --kubernetesCollector.includeNodeLabels=false
            - --kubernetesCollector.includePodAnnotations=false
            - --kubernetesCollector.includePodLabels
            - --kubernetesCollector.msgField=message.msg,message,msg
            - --kubernetesCollector.timeField=message.time,message.ts,message.timestamp,m,time,ts,timestamp
            - --loggerFormat=json
            - --remoteWrite.headers="AccountID:0^^ProjectID:0"
            - --remoteWrite.url=http://vlsingle-victoria-logs:9428/insert/native
            - --tmpDataPath=/vl-collector
          image: victoriametrics/vlagent:v1.43.1
          imagePullPolicy: IfNotPresent
          name: collector
          ports:
            - containerPort: 9429
              name: http
              protocol: TCP
          securityContext: {}
          volumeMounts:
            - mountPath: /var/log
              name: varlog
              readOnly: true
            - mountPath: /var/lib
              name: varlib
              readOnly: true
            - mountPath: /vl-collector
              name: vl-collector-data
      securityContext: {}
      serviceAccountName: vl-collector-victoria-logs-collector
      volumes:
        - hostPath:
            path: /var/log
          name: varlog
        - hostPath:
            path: /var/lib
          name: varlib
        - hostPath:
            path: /var/lib/vl-collector
          name: vl-collector-data
