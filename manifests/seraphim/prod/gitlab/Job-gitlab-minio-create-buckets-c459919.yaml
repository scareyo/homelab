apiVersion: batch/v1
kind: Job
metadata:
  labels:
    app: minio
    chart: minio-0.4.3
    heritage: Helm
    release: gitlab
  name: gitlab-minio-create-buckets-c459919
  namespace: gitlab
spec:
  activeDeadlineSeconds: 600
  template:
    metadata:
      labels:
        app: minio
        chart: minio-0.4.3
        component: create-buckets
        heritage: Helm
        release: gitlab
    spec:
      automountServiceAccountToken: false
      containers:
        - command:
            - /bin/sh
            - /config/initialize
          env:
            - name: HOME
              value: /tmp
            - name: MINIO_ENDPOINT
              value: gitlab-minio-svc.gitlab.svc
            - name: MINIO_PORT
              value: "9000"
          image: registry.gitlab.com/gitlab-org/cloud-native/mirror/images/minio/mc:RELEASE.2018-07-13T00-53-22Z
          name: minio-mc
          resources:
            requests:
              cpu: 50m
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                - ALL
            runAsNonRoot: true
            runAsUser: 1000
          volumeMounts:
            - mountPath: /config
              name: minio-configuration
      restartPolicy: OnFailure
      securityContext:
        fsGroup: 1000
        runAsUser: 1000
        seccompProfile:
          type: RuntimeDefault
      volumes:
        - name: minio-configuration
          projected:
            sources:
              - configMap:
                  name: gitlab-minio-config-cm
              - secret:
                  name: gitlab-minio-secret
