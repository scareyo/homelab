apiVersion: v1
data:
  cable.yml.erb: "production:\n  url: redis://:<%= ERB::Util::url_encode(File.read(\"/etc/gitlab/redis/redis-password\").strip) %>@gitlab-redis-master.gitlab.svc:6379/0\n  \n  id:\n  adapter: redis\n"
  configure: |
    # BEGIN gitlab.scripts.configure.secrets
    set -e
    config_dir="/init-config"
    secret_dir="/init-secrets"
    # required
    for secret in rails-secrets migrations gitaly ; do
      mkdir -p "${secret_dir}/${secret}"
      cp -f -v -r -L "${config_dir}/${secret}/." "${secret_dir}/${secret}/"
    done
    # optional
    for secret in redis redis-sentinel minio objectstorage postgres ldap duo omniauth smtp kas pages oauth-secrets mailroom gitlab-exporter microsoft_graph_mailer zoekt clickhouse openbao ; do
      if [ -e "${config_dir}/${secret}" ]; then
        mkdir -p "${secret_dir}/${secret}"
        cp -f -v -r -L "${config_dir}/${secret}/." "${secret_dir}/${secret}/"
      fi
    done
    # END gitlab.scripts.configure.secrets
  database.yml.erb: "\nproduction:\n  main:\n    adapter: postgresql\n    encoding: unicode\n    database: gitlabhq_production\n    username: app\n    password: <%= File.read('/etc/gitlab/postgres/psql-password-main').strip.to_json %>\n    host: \"gitlab-rw\"\n    port: 5432\n    connect_timeout: \n    keepalives: \n    keepalives_idle: \n    keepalives_interval: \n    keepalives_count: \n    tcp_user_timeout: \n    application_name: \n    prepared_statements: false\n    database_tasks: true\n    \n    \n  ci:\n    adapter: postgresql\n    encoding: unicode\n    database: gitlabhq_production\n    username: app\n    password: <%= File.read('/etc/gitlab/postgres/psql-password-ci').strip.to_json %>\n    host: \"gitlab-rw\"\n    port: 5432\n    connect_timeout: \n    keepalives: \n    keepalives_idle: \n    keepalives_interval: \n    keepalives_count: \n    tcp_user_timeout: \n    application_name: \n    prepared_statements: false\n    database_tasks: false\n    \n    \n"
  gitlab.yml.erb: "production: &base\n  gitlab:\n    host: gitlab.vegapunk.cloud\n    https: true\n  artifacts:\n    enabled: true\n    object_store:\n      enabled: true\n      remote_directory: gitlab-artifacts\n      proxy_download: true\n      connection:\n        provider: AWS\n        region: us-east-1\n        host: minio.vegapunk.cloud\n        endpoint: http://gitlab-minio-svc.gitlab.svc:9000\n        path_style: true\n        aws_access_key_id: <%= File.read('/etc/gitlab/minio/accesskey').strip.to_json %>\n        aws_secret_access_key: <%= File.read('/etc/gitlab/minio/secretkey').strip.to_json %>\n  lfs:\n    enabled: true\n    object_store:\n      enabled: true\n      remote_directory: git-lfs\n      proxy_download: true\n      connection:\n        provider: AWS\n        region: us-east-1\n        host: minio.vegapunk.cloud\n        endpoint: http://gitlab-minio-svc.gitlab.svc:9000\n        path_style: true\n        aws_access_key_id: <%= File.read('/etc/gitlab/minio/accesskey').strip.to_json %>\n        aws_secret_access_key: <%= File.read('/etc/gitlab/minio/secretkey').strip.to_json %>\n  uploads:\n    enabled: true\n    object_store:\n      enabled: true\n      remote_directory: gitlab-uploads\n      proxy_download: true\n      connection:\n        provider: AWS\n        region: us-east-1\n        host: minio.vegapunk.cloud\n        endpoint: http://gitlab-minio-svc.gitlab.svc:9000\n        path_style: true\n        aws_access_key_id: <%= File.read('/etc/gitlab/minio/accesskey').strip.to_json %>\n        aws_secret_access_key: <%= File.read('/etc/gitlab/minio/secretkey').strip.to_json %>\n  packages:\n    enabled: true\n    object_store:\n      enabled: true\n      remote_directory: gitlab-packages\n      proxy_download: true\n      connection:\n        provider: AWS\n        region: us-east-1\n        host: minio.vegapunk.cloud\n        endpoint: http://gitlab-minio-svc.gitlab.svc:9000\n        path_style: true\n        aws_access_key_id: <%= File.read('/etc/gitlab/minio/accesskey').strip.to_json %>\n        aws_secret_access_key: <%= File.read('/etc/gitlab/minio/secretkey').strip.to_json %>\n  external_diffs:\n    enabled: false\n    when: \n    object_store:\n      enabled: false\n      remote_directory: gitlab-mr-diffs\n      proxy_download: true\n  terraform_state:\n    enabled: false\n    object_store:\n      enabled: false\n      remote_directory: gitlab-terraform-state\n      proxy_download: true\n  ci_secure_files:\n    enabled: false\n    object_store:\n      enabled: false\n      remote_directory: gitlab-ci-secure-files\n      proxy_download: true\n  gitaly:\n    client_path: /home/git/gitaly/bin\n    token: <%= File.read('/etc/gitlab/gitaly/gitaly_token').strip.to_json %>\n  repositories:\n    storages: # You must have at least a `default` storage path.\n      default:\n        path: /var/opt/gitlab/repo\n        gitaly_address: tcp://gitlab-gitaly-0.gitlab-gitaly.gitlab.svc:8075\n      \n  \n  sidekiq:\n    log_format: json\n  oidc_provider:\n    openid_id_token_expire_in_seconds: 120\n  \n  \n"
  installation_type: |
    gitlab-helm-chart
  pages_redirect_uri: https://projects.pages.vegapunk.cloud/auth
  redis.action_cable.yml.erb: "production:\n  url: redis://:<%= ERB::Util::url_encode(File.read(\"/etc/gitlab/redis/redis-password\").strip) %>@gitlab-redis-master.gitlab.svc:6379/0\n  \n  id:\n"
  resque.yml.erb: "production:\n  url: redis://:<%= ERB::Util::url_encode(File.read(\"/etc/gitlab/redis/redis-password\").strip) %>@gitlab-redis-master.gitlab.svc:6379/0\n  \n  id:\n"
kind: ConfigMap
metadata:
  labels:
    app: migrations
    chart: migrations-9.8.2
    heritage: Helm
    release: gitlab
  name: gitlab-migrations
  namespace: gitlab
