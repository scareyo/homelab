---
- name: Destroy Cozystack Platform
  hosts: seraphim
  connection: local
  tasks:
    - name: Wipe data disk
      ansible.builtin.command:
        cmd: "talm -f nodes/{{ inventory_hostname }}.yaml wipe disk nvme0n1 --talosconfig {{ cozystack_talosconfig }}"
        chdir: "{{ cozystack_cluster_dir }}"
      changed_when: true

    - name: Reset machines
      ansible.builtin.command:
        cmd: "talm -f nodes/{{ inventory_hostname }}.yaml reset --graceful=false --talosconfig {{ cozystack_talosconfig }}"
        chdir: "{{ cozystack_cluster_dir }}"
      changed_when: true
