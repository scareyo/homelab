---
- name: "Sync {{ item.name }}"
  ansible.builtin.command: argocd app sync {{ item.name }}
  retries: 8
  delay: 10
  async: 300
  poll: 0
  changed_when: true

- name: "Wait for {{ item.name }}"
  ansible.builtin.command: argocd app wait {{ item.name }}
  retries: 4
  delay: 10
  changed_when: false
  when: item.wait
