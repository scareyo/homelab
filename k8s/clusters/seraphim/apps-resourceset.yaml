---
apiVersion: fluxcd.controlplane.io/v1
kind: ResourceSet
metadata:
  name: apps
spec:
  inputsFrom:
    - apiVersion: fluxcd.controlplane.io/v1
      kind: ResourceSetInputProvider
      name: apps

  dependsOn:
    - apiVersion: fluxcd.controlplane.io/v1
      kind: ResourceSet
      name: seraphim
      namespace: flux-system
      ready: true

  resourcesTemplate: |
    <<- range $app := inputs.apps >>
    ---
    apiVersion: kustomize.toolkit.fluxcd.io/v1
    kind: Kustomization
    metadata:
      name: << $app.name >>
      namespace: flux-system
    spec:
      path: << $app.path >>
      interval: 30m
      retryInterval: 5m
      prune: true
      timeout: 5m
      sourceRef:
        kind: GitRepository
        name: flux-system
    <<- end >>
